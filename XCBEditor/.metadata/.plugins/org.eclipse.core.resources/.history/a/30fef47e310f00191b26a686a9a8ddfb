package XCBVisualEditor.XCBVisualEditor;

import java.awt.EventQueue;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.util.Vector;

import javax.swing.JFrame;

import XCBVisualEditor.XCDJsonInfo;
import XCBVisualEditor.XCBJson.ConfigJsonReader;
import XCBVisualEditor.XCBUtil.XCBSelectBox;

import javax.swing.JTextField;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JScrollPane;
import javax.swing.JTree;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.DefaultTreeModel;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.DefaultListModel;
import javax.swing.JButton;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import javax.swing.JList;
import javax.swing.JComboBox;

public class XCBVisualBlade {
	private ConfigJsonReader jsondata;
	private DefaultListModel blademenu;
	public String bladeUuid,bladeName,bladeModel,bladeTexture;
	public int damage,duration,sa,color=3316172;
	private boolean iswitched=false;
	public JFrame frmXCBVisualBlade;
	private JLabel ValueLabel;
	private XCDJsonInfo bladeinfo;
	private Vector EnchantList=new Vector();
	private Vector EnchantLevel=new Vector();
	private DefaultListModel EnchantDLM=new DefaultListModel();
	private String[] enchantment= {"power","unbreaking","looting","sharpness","infinity","thorns","knockback","baneOfArthropods",
			"blastProtection","featherFalling","fireAspect","fireProtection","flame","fortune","projectileProtection","protection",
			"punch","respiration","silkTouch","smite"};
	public XCBVisualBlade(ConfigJsonReader data,DefaultListModel input,XCDJsonInfo info) {
		this.bladeinfo=info;
		this.blademenu=input;
		this.jsondata=data;
		EnchantLoadFromInfo();
		initialize();
		dataLoadFromInfo();
	}
	private void dataLoadFromInfo() {
		if(this.bladeinfo!=null) {
			this.bladeName=bladeinfo.showName;
			this.bladeUuid=bladeinfo.bladename;
			this.bladeTexture=bladeinfo.bladeTexture;
			this.bladeModel=bladeinfo.bladeModel;
			this.sa=bladeinfo.sa;
			this.duration=bladeinfo.bladeduration;
			this.damage=(int) bladeinfo.bladedamage;
			this.iswitched=bladeinfo.iswitched;
			this.color=bladeinfo.color;
			System.out.println("XCC:Try to replace data from config.");
		}else {
			System.out.println("XCC:Null");
		}
	}
	private void EnchantLoadFromInfo() {
		if(this.bladeinfo!=null) {
			if(bladeinfo.EnchantName!=null&&bladeinfo.EnchantLevel!=null) {
				this.EnchantList=bladeinfo.EnchantName;
				this.EnchantLevel=bladeinfo.EnchantLevel;
				for(int i=0;i<bladeinfo.EnchantName.size();i++) {
					System.out.println(EnchantList.get(i).toString()+EnchantLevel.get(i).toString());
					EnchantDLM.addElement("附魔"+EnchantList.get(i).toString()+" 等级"+EnchantLevel.get(i).toString());
				}
			}else {
				System.out.println("XCC Enchantment NULL.");
			}
		}else {
			System.out.println("XCC BladeInfo NULL.");
		}
	}
	private void initialize() {
		XCBVisualBlade tempClass=this;
		frmXCBVisualBlade = new JFrame();
		frmXCBVisualBlade.setResizable(false);
		frmXCBVisualBlade.setTitle("XCBVisualEditor -CreateBlade");
		frmXCBVisualBlade.setBounds(100, 100, 436, 320);
		frmXCBVisualBlade.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
		frmXCBVisualBlade.getContentPane().setLayout(null);
		
		JLabel label = new JLabel("");
		label.setBounds(10, 32, 54, 15);
		frmXCBVisualBlade.getContentPane().add(label);
		
		XCBVisualBlade classTemp=this;
		JTree BladeTreeInfo = new JTree();
		BladeTreeInfo.setModel(new DefaultTreeModel(
			new DefaultMutableTreeNode("New blade") {
				{
					DefaultMutableTreeNode node_1;
					add(new DefaultMutableTreeNode("BladeUUID"));
					add(new DefaultMutableTreeNode("BladeShowName"));
					add(new DefaultMutableTreeNode("ModelAddress"));
					add(new DefaultMutableTreeNode("TextureAddress"));
					node_1 = new DefaultMutableTreeNode("Details");
						node_1.add(new DefaultMutableTreeNode("SA"));
						node_1.add(new DefaultMutableTreeNode("Duration"));
						node_1.add(new DefaultMutableTreeNode("Damage"));
						node_1.add(new DefaultMutableTreeNode("isWitched"));
						node_1.add(new DefaultMutableTreeNode("DecimalColorCode"));
					add(node_1);
					add(new DefaultMutableTreeNode("CustomizedRecipe"));
				}
			}
		));
		BladeTreeInfo.addMouseListener(new MouseListener() {
			@Override
			public void mouseClicked(MouseEvent event) {
				String temp=null;
				if(event.getSource() == BladeTreeInfo) 
					workToLabel(BladeTreeInfo.getLastSelectedPathComponent().toString());
				if(event.getSource() == BladeTreeInfo &&event.getClickCount()==2) {
					if(BladeTreeInfo.getPathForLocation(event.getX(), event.getY())!=null) {
						switch(BladeTreeInfo.getLastSelectedPathComponent().toString()) {
							case "BladeUUID":
								temp = JOptionPane.showInputDialog(null,"输入拔刀剑识别名",bladeUuid);
								if(temp!=null)
									bladeUuid=temp;
								break;
							case "BladeShowName":
								temp = JOptionPane.showInputDialog(null,"输入拔刀剑显示名",bladeName);
								if(temp!=null)
									bladeName=temp;
								break;
							case "ModelAddress":
								temp = JOptionPane.showInputDialog(null,"输入拔刀剑模型路径",bladeModel);
								if(temp!=null)
									bladeModel=temp;
								break;
							case "TextureAddress":
								temp = JOptionPane.showInputDialog(null,"输入拔刀剑贴图路径",bladeTexture);
								if(temp!=null)
									bladeTexture=temp;
								break;
							case "SA":
								XCBSpecialAttackSelect saWin=new XCBSpecialAttackSelect(classTemp,sa);
								saWin.frmXCCVESA.setVisible(true);
								break;
							case "Duration":
								temp = JOptionPane.showInputDialog(null,"输入拔刀剑耐久",String.valueOf(duration));
								if(temp!=null)
									duration=Integer.valueOf(temp);
								break;
							case "Damage":
								temp = JOptionPane.showInputDialog(null,"输入拔刀剑基础威力",String.valueOf(damage));
								if(temp!=null)
									damage=Integer.valueOf(temp);
								break;
							case "isWitched":
								if(JOptionPane.showConfirmDialog(null, "是否为妖刀？", "妖刀确认", 0)==0)//Yes
									iswitched=true;
								else 
									iswitched=false;
								break;
							case "DecimalColorCode":
								XCBColorSelect colorWin=new XCBColorSelect(color);
								colorWin.frmXccVisualeditorColor.setVisible(true);
								break;
								
						}	
					}
				}
			}
			@Override
			public void mouseEntered(MouseEvent e) {}
			@Override
			public void mouseExited(MouseEvent e) {}
			@Override
			public void mousePressed(MouseEvent e) {}
			@Override
			public void mouseReleased(MouseEvent e) {}
			});
		BladeTreeInfo.setBounds(20, 44, 172, 200);
		frmXCBVisualBlade.getContentPane().add(BladeTreeInfo);
		
		JButton btnNewButton = new JButton("确认");
		btnNewButton.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				XCDJsonInfo info=new XCDJsonInfo(sa,0,duration,color,iswitched,damage,bladeUuid,bladeName,
						bladeModel,bladeTexture,false,null,EnchantList,EnchantLevel);
						int ret=jsondata.addToJson(info);
						switch(ret) {
							case 1:
								JOptionPane.showMessageDialog(null, "配置已经保存.");break;
							case 0:
								JOptionPane.showMessageDialog(null, "输入不完整！");return;
							case -1:
								JOptionPane.showMessageDialog(null, "配置文件写入失败！");break;
							case -2:
								JOptionPane.showMessageDialog(null, "拔刀重写完成！");break;
						}
						frmXCBVisualBlade.setVisible(false);
						try {
							tempClass.finalize();
						} catch (Throwable error) {}
			}
		});
		btnNewButton.setBounds(202, 213, 186, 29);
		frmXCBVisualBlade.getContentPane().add(btnNewButton);
		
		ValueLabel = new JLabel("Not selected.");
		ValueLabel.setBounds(30, 254, 358, 15);
		frmXCBVisualBlade.getContentPane().add(ValueLabel);
		
		JLabel label_1 = new JLabel("附魔");
		label_1.setBounds(202, 19, 54, 15);
		frmXCBVisualBlade.getContentPane().add(label_1);
		
		JLabel label_2 = new JLabel("拔刀信息");
		label_2.setBounds(20, 19, 54, 15);
		frmXCBVisualBlade.getContentPane().add(label_2);
		
		JScrollPane scrollPane=new JScrollPane();
		scrollPane.setBounds(202, 44, 186, 95);
		frmXCBVisualBlade.getContentPane().add(scrollPane);
		
		JList EnchantShowList = new JList();
		scrollPane.setViewportView(EnchantShowList);
		EnchantShowList.setModel(EnchantDLM);
		
		JComboBox<String> EnchantmentSelect = new JComboBox<>(new XCBSelectBox(enchantment));
		EnchantmentSelect.setBounds(202, 145, 186, 24);
		frmXCBVisualBlade.getContentPane().add(EnchantmentSelect);
		
		JButton add = new JButton("添加");
		add.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				if(EnchantmentSelect.getSelectedItem()!=null) {
					int level=1;
					level=Integer.valueOf((JOptionPane.showInputDialog(null,"输入附魔等级","1")));
					EnchantList.add(EnchantmentSelect.getSelectedItem().toString());
					EnchantLevel.add(level);
					EnchantDLM.addElement("附魔"+EnchantmentSelect.getSelectedItem().toString()+" 等级"+level);
					EnchantShowList.setModel(EnchantDLM);
				}else {
					JOptionPane.showMessageDialog(null, "未选择附魔！");
				}
			}
		});
		add.setBounds(202, 179, 88, 24);
		frmXCBVisualBlade.getContentPane().add(add);
		
		JButton del = new JButton("删除");
		del.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
				if(!EnchantShowList.isSelectionEmpty()) {
					int index=0;
					index=EnchantShowList.getSelectedIndex();
					EnchantList.remove(index);
					EnchantLevel.remove(index);
					EnchantDLM.remove(index);
					EnchantShowList.setModel(EnchantDLM);
					System.out.println(index);
				}else {
					JOptionPane.showMessageDialog(null, "未选择附魔！");
				}
			}
		});
		del.setBounds(300, 179, 88, 24);
		frmXCBVisualBlade.getContentPane().add(del);
	}
	public void workToLabel(String name) {
		switch(name) {
			case "BladeUUID":
				ValueLabel.setText(name+":"+this.bladeUuid);
				break;
			case "BladeShowName":
				ValueLabel.setText(name+":"+this.bladeName);
				break;
			case "ModelAddress":
				ValueLabel.setText(name+":"+this.bladeModel);
				break;
			case "TextureAddress":
				ValueLabel.setText(name+":"+this.bladeTexture);
				break;
			case "SA":
				ValueLabel.setText(name+":"+String.valueOf(this.sa));
				break;
			case "Duration":
				ValueLabel.setText(name+":"+String.valueOf(this.duration));
				break;
			case "Damage":
				ValueLabel.setText(name+":"+String.valueOf(this.damage));
				break;
			case "isWitched":
				ValueLabel.setText(name+":"+String.valueOf(this.iswitched));
				break;
			case "DecimalColorCode":
				ValueLabel.setText(name+":"+String.valueOf(this.color));
				break;
		}	
	}
}
